<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista de Cuenta</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/src/features/cuentas/style/style.css">
</head>
<body>

     <div class="barra-de-tareas">
    <a href="/src/features/vista_comandas/Comandas.html"><button class="BotonA">Comandar</button></a>
    <button class="BotonB">Cuenta</button>
    <!-- Enlace a Mesas: se decidirá dinámicamente a qué panel ir según el rol -->
    <a id="linkMesas" href="#"><button class="BotonB">Mesas</button></a>
    <div class="estado-usuario">
      <span class="estado"></span>
      <!-- El nombre de usuario se llenará dinámicamente -->
      <span class="usuario"></span>
    </div>
  </div>

    <main class="main-container">
        <div class="left-panel">
            <div class="table-display-box">
                <!-- Mostramos el icono de la mesa y, debajo, el número de mesa.  Estos valores se
                     rellenan dinámicamente a partir de localStorage cuando la página se carga. -->
                <img id="table-icon" src="/src/assets/icon mesa.png" alt="Icono Mesa" class="mesa-icon" />
                <span id="table-number" class="mesa-number"></span>
            </div>
            <div class="button-group">
                <button class="action-button secondary"><a href="/src/features/gestion_comandas/GestionComandasM.html"></a>Visualizar</button>
            </div>
            <button class="action-button">Imprimir</button>
        </div>

        <div class="right-panel">
            <div class="receipt-header">
                <h2>Restapp</h2>
                <p>Suchiapa, CHIS</p>
            </div>
            <table class="receipt-table">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Precio</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Carne asada</td>
                        <td>$180.00</td>
                    </tr>
                    <tr>
                        <td>Ensalada de pollo</td>
                        <td>$90.00</td>
                    </tr>
                    <tr>
                        <td>Camarones empanizados</td>
                        <td>$220.00</td>
                    </tr>
                </tbody>
                <tfoot>
                    <!-- Añadimos una fila para mostrar el número de personas asociado a la cuenta.  El valor se
                         rellenará dinámicamente mediante JavaScript. -->
                    <tr>
                        <td>Número de personas</td>
                        <td id="num-personas"></td>
                    </tr>
                    <tr>
                        <td>Subtotal</td>
                        <td>$490.00</td>
                    </tr>
                    <tr>
                        <td>IVA</td>
                        <td>$78.00</td>
                    </tr>
                    <tr>
                        <td>Total</td>
                        <td>$568.00</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </main>

    <!-- Script para dinamizar el usuario y redirección de Mesas en la vista de cuentas del mesero -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const nombreUsuario = localStorage.getItem('usuario_nombre') || '';
        const mesaNumero = localStorage.getItem('mesa_numero') || '';
        const userSpan = document.querySelector('.barra-de-tareas .usuario');
        if (userSpan) {
          if (nombreUsuario && mesaNumero) {
            userSpan.textContent = `${nombreUsuario} | Mesa ${mesaNumero}`;
          } else if (nombreUsuario) {
            userSpan.textContent = nombreUsuario;
          }
        }
        // Mostrar el número de mesa en el panel izquierdo.
        const tableNumberElem = document.getElementById('table-number');
        if (tableNumberElem) {
          tableNumberElem.textContent = mesaNumero || '';
        }
        // Rellenar el número de personas si está almacenado en localStorage.
        const numPersonasStored = localStorage.getItem('mesa_num_personas');
        const numPersonasElem = document.getElementById('num-personas');
        if (numPersonasElem && numPersonasStored) {
          numPersonasElem.textContent = numPersonasStored;
        }
        const linkMesas = document.getElementById('linkMesas');
        if (linkMesas) {
          linkMesas.addEventListener('click', function(e) {
            e.preventDefault();
            const rol = localStorage.getItem('user_role');
            if (rol === 'Mesero') {
              window.location.href = '/src/features/panel_mesa/panelMesaMesero.html';
            } else {
              window.location.href = '/src/features/panel_mesa/PanelMesa.html';
            }
          });
        }
      });
    </script>

</body>
</html>